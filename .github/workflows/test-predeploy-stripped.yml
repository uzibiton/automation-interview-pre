name: 'Test: Pre-Deploy Stripped'

on:
  workflow_call:
    inputs:
      skip_unit_tests:
        type: boolean
        default: false
    outputs:
      timestamp:
        description: 'CI Run timestamp'
        value: ${{ jobs.generate-timestamp.outputs.timestamp }}

jobs:
  generate-timestamp:
    name: Generate CI Run ID
    runs-on: ubuntu-latest
    outputs:
      timestamp: ${{ steps.timestamp.outputs.value }}
    steps:
      - name: Generate timestamp for this CI run
        id: timestamp
        run: echo "value=$(date -u +%Y-%m-%dT%H-%M-%S-%3NZ)" >> $GITHUB_OUTPUT

  code-quality:
    name: Code Quality
    runs-on: ubuntu-latest
    needs: [generate-timestamp]
    steps:
      - name: Start Code Quality Checks
        run: echo "Starting code quality checks"

  prettier:
    name: Code Formatting
    needs: [code-quality]
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Check formatting
        run: echo "Prettier check"

  unit-tests:
    name: Unit Tests
    needs: [generate-timestamp]
    if: ${{ !inputs.skip_unit_tests }}
    runs-on: ubuntu-latest
    steps:
      - name: Run unit tests
        run: echo "Running unit tests"

  gate:
    name: Gate
    needs: [prettier, unit-tests]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Check results
        run: echo "All checks complete"
