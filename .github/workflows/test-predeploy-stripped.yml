name: 'Test: Pre-Deploy Stripped'

on:
  workflow_call:
    inputs:
      skip_test:
        type: boolean
        default: false
    outputs:
      timestamp:
        description: 'CI Run timestamp'
        value: ${{ jobs.generate-timestamp.outputs.timestamp }}

jobs:
  generate-timestamp:
    name: Generate CI Run ID
    runs-on: ubuntu-latest
    outputs:
      timestamp: ${{ steps.timestamp.outputs.value }}
    steps:
      - name: Generate timestamp for this CI run
        id: timestamp
        run: echo "value=$(date -u +%Y-%m-%dT%H-%M-%S-%3NZ)" >> $GITHUB_OUTPUT

  test-job:
    name: Test Job
    needs: [generate-timestamp]
    runs-on: ubuntu-latest
    if: ${{ !inputs.skip_test }}
    steps:
      - name: Run test
        run: echo "Running test at ${{ needs.generate-timestamp.outputs.timestamp }}"

  gate:
    name: Gate
    needs: [test-job]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Check results
        run: echo "Test result - ${{ needs.test-job.result }}"
